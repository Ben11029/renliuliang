<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡Œæ¸¸è®¡åˆ†å™¨(Wingspan + PARKS 2)</title> <!-- æ›´æ”¹ï¼šæ›´æ–°æ ‡é¢˜ -->
    <link rel="icon" href="favicon.png" type="image/png">
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Inter å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* ä½¿ç”¨ Inter å­—ä½“ä½œä¸ºåŸºç¡€å­—ä½“ */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        
        /* æ›´æ”¹ï¼šä¸º WINGSPAN æ·»åŠ ç‹¬ç«‹çš„è·èƒœè€…æ ·å¼ */
        .winner-col-ws {
            background-color: #FEF9C3; /* yellow-200 */
        }
        /* æ–°å¢ï¼šä¸º PARKS æ·»åŠ ç‹¬ç«‹çš„è·èƒœè€…æ ·å¼ */
        .winner-col-parks {
            background-color: #FDE68A; /* amber-300 */
        }

        /* ä¼˜åŒ–æ•°å­—è¾“å…¥æ¡†åœ¨ Webkit æµè§ˆå™¨ä¸Šçš„æ˜¾ç¤º (ç§»é™¤å°ç®­å¤´) */
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type='number'] {
            -moz-appearance: textfield; /* ç§»é™¤ Firefox ä¸Šçš„å°ç®­å¤´ */
        }
        /* è¡¨æ ¼è¾“å…¥æ¡†æ ·å¼ */
        .table-input {
            width: 70px; /* å›ºå®šå®½åº¦ï¼Œå› ä¸ºç°åœ¨æ˜¯å‚ç›´çš„ */
            padding: 8px 4px;
            border: 1px solid #D1D5DB; /* gray-300 */
            border-radius: 6px;
            text-align: center;
            font-size: 1.125rem; /* text-sm */
        }
        .table-input:focus {
            border-color: #3B82F6; /* blue-500 */
            box-shadow: 0 0 0 2px #BFDBFE; /* blue-200 */
            outline: none;
        }
        /* ç©å®¶åå­—è¾“å…¥æ¡† */
        .player-name-input {
            width: 70px;
            text-align: center;
            font-weight: bold;
            font-size: 1.125rem;
            border: 2px solid transparent;
            border-radius: 6px;
            padding: 4px;
        }
        .player-name-input:focus {
            border-color: #3B82F6; /* blue-500 */
            outline: none;
        }
    </style>
</head>
<body class="bg-stone-100 min-h-screen"> <!-- æ›´æ”¹ï¼šæ›´è‡ªç„¶çš„èƒŒæ™¯è‰² -->

    <!-- 1. é¡¶éƒ¨æ§åˆ¶æ  -->
    <header class="bg-white p-4 shadow-md sticky top-0 z-20"> <!-- æ›´æ”¹ï¼šz-20 ç¡®ä¿åœ¨æ¯›ç»ç’ƒä¹‹ä¸Š -->
        <div class="container mx-auto flex flex-wrap justify-between items-center gap-4">
            <h1 class="text-2xl font-bold text-teal-800">
                ğŸ² æ¡Œæ¸¸è®¡åˆ†å™¨ Wingspan + Parks 2
            </h1>
            <!-- ç§»é™¤äº†å…¨å±€çš„æ·»åŠ /é‡ç½®æŒ‰é’® -->
        </div>
    </header>

    <!-- 2. WINGSPAN è®¡åˆ†å™¨éƒ¨åˆ† -->
    <section id="wingspan-section" class="p-4 md:p-6">
        <!-- æ›´æ”¹ï¼šæ·»åŠ äº† Wingspan çš„ä¸“å±æ§åˆ¶æ  -->
        <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
            <h2 class="text-xl font-bold text-teal-700">ğŸ¦ å±•ä»ªç¿±ç¿” (Wingspan)</h2>
            <div class="flex gap-3 flex-shrink-0">
                <button id="ws-add-player" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded transition-colors">
                    ï¼‹ æ·»åŠ ç©å®¶
                </button>
                <button id="ws-reset-game" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors">
                    ğŸ”„ é‡ç½®æ¸¸æˆ
                </button>
            </div>
        </div>
        
        <!-- Wingspan è®¡åˆ†è¡¨æ ¼ -->
        <div class="overflow-x-auto bg-white rounded-lg shadow-lg">
            <table class="w-full min-w-max" id="wingspan-score-table">
                <!-- æ›´æ”¹ï¼šæ‰€æœ‰ ID æ·»åŠ  'ws-' å‰ç¼€ -->
                <thead>
                    <tr id="ws-remove-row" class="bg-stone-100 border-b border-gray-200">
                        <th class="p-2 sticky left-0 bg-stone-100/75 backdrop-blur-sm text-sm font-medium text-gray-600 z-10">ç§»é™¤ç©å®¶</th>
                    </tr>
                    <tr id="ws-player-name-row" class="text-gray-700"> <!-- JS ä¼šåº”ç”¨ä¸»é¢˜ -->
                        <th class="p-4 text-left text-sm font-bold sticky left-0 z-10">
                            <span class="theme-placeholder">è®¡åˆ†é¡¹</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ¦é¸Ÿç‰Œæ€»åˆ†</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">â­å¥–åŠ±å¡åˆ†</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ†è½®æœ«ç›®æ ‡</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ¥šé¸Ÿè›‹æ€»åˆ†</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ‡è´®è—é£Ÿç‰©</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ”€å¡å…¥å¡ç‰‡</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr id="ws-total-row"> <!-- JS ä¼šåº”ç”¨ä¸»é¢˜ -->
                        <td class="p-4 text-sm font-bold sticky left-0 z-10">
                            <span class="total-text-placeholder text-amber-900">ğŸ‘‘ æ€»åˆ†</span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </section>

    <!-- é¡µé¢åˆ†éš”çº¿ -->
    <hr class="container mx-auto border-t-2 border-stone-300 my-4">

    <!-- 3. PARKS è®¡åˆ†å™¨éƒ¨åˆ† -->
    <section id="parks-section" class="p-4 md:p-6">
        <!-- ... (PARKS header) ... -->
        <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
            <h2 class="text-xl font-bold text-green-800">ğŸŒ² å›½å®¶å…¬å›­ 2 (PARKS 2)</h2>
            <div class="flex gap-3 flex-shrink-0">
                <button id="parks-add-player" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors">
                    ï¼‹ æ·»åŠ ç©å®¶
                </button>
                <button id="parks-reset-game" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors">
                    ğŸ”„ é‡ç½®æ¸¸æˆ
                </button>
            </div>
        </div>

        <!-- æ–°å¢ï¼šPARKS è®¡åˆ†è¡¨æ ¼ -->
        <div class="overflow-x-auto bg-white rounded-lg shadow-lg">
            <table class="w-full min-w-max" id="parks-score-table">
                <!-- ... (PARKS thead) ... -->
                <thead>
                    <tr id="parks-remove-row" class="bg-stone-100 border-b border-gray-200">
                        <th class="p-2 sticky left-0 bg-stone-100/75 backdrop-blur-sm text-sm font-medium text-gray-600 z-10">ç§»é™¤ç©å®¶</th>
                    </tr>
                    <tr id="parks-player-name-row" class="text-gray-700"> <!-- JS ä¼šåº”ç”¨ä¸»é¢˜ -->
                        <th class="p-4 text-left text-sm font-bold sticky left-0 z-10">
                             <span class="theme-placeholder">è®¡åˆ†é¡¹</span>
                        </th>
                    </tr>
                </thead>
                <!-- æ›´æ”¹ï¼šPARKS è®¡åˆ†é¡¹å·²æ ¹æ®è§„åˆ™æ›´æ–° -->
                <tbody>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸŒ²å…¬å›­æ€»åˆ†</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ§‘ä¸ªäººç›®æ ‡</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ–¼ï¸ç…§ç‰‡æ€»åˆ†</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ“·ç…§ç‰‡å¥–åŠ±</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ“…å­£èŠ‚å¥–åŠ±</td>
                    </tr>
                    <tr class="border-b border-gray-200">
                        <td class="p-4 text-sm font-medium sticky left-0 bg-white/75 backdrop-blur-sm">ğŸ–ï¸èµ·å§‹ç©å®¶</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr id="parks-total-row"> <!-- JS ä¼šåº”ç”¨ä¸»é¢˜ -->
                        <td class="p-4 text-sm font-bold sticky left-0 z-10">
                            <span class="total-text-placeholder text-orange-900">ğŸ‘‘ æ€»åˆ†</span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </section>


    <!-- 4. åº•éƒ¨æç¤º -->
    <footer class="text-center p-6 text-gray-500 text-sm">
        <p>ç¥æ‚¨æ¸¸æˆæ„‰å¿«ï¼</p>
        <!-- æ›´æ”¹ï¼šæ·»åŠ  PARKS å¹³å±€è§„åˆ™ -->
        <p class="mt-1">Wingspanå¹³å±€æç¤ºï¼šå¹³å±€æ—¶ï¼Œå‰©ä½™é£Ÿç‰©æœ€å¤šè€…è·èƒœã€‚</p>
    </footer>

    <!-- 5. JavaScript é€»è¾‘ (æ— åŠŸèƒ½æ€§æ›´æ”¹ï¼Œå®ƒä¼šè‡ªåŠ¨é€‚é…æ–°çš„è¡Œ) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- WINGSPAN é…ç½® ---
            const wsConfig = {
                tableId: 'wingspan-score-table',
                addPlayerBtnId: 'ws-add-player',
                resetGameBtnId: 'ws-reset-game',
                playerNameRowId: 'ws-player-name-row',
                removeRowId: 'ws-remove-row',
                totalRowId: 'ws-total-row',
                defaultPlayerPrefix: 'ç©å®¶',
                theme: {
                    playerRow: 'bg-cyan-100',
                    playerRowSticky: 'bg-cyan-100/75',
                    totalRow: 'bg-amber-100',
                    totalRowSticky: 'bg-amber-100/75',
                    totalText: 'text-amber-900',
                    winnerCol: 'winner-col-ws'
                }
            };

            // --- PARKS é…ç½® ---
            const parksConfig = {
                tableId: 'parks-score-table',
                addPlayerBtnId: 'parks-add-player',
                resetGameBtnId: 'parks-reset-game',
                playerNameRowId: 'parks-player-name-row',
                removeRowId: 'parks-remove-row',
                totalRowId: 'parks-total-row',
                defaultPlayerPrefix: 'Hiker',
                theme: {
                    playerRow: 'bg-green-100', // æ£®æ—
                    playerRowSticky: 'bg-green-100/75',
                    totalRow: 'bg-orange-100', // æ—¥è½
                    totalRowSticky: 'bg-orange-100/75',
                    totalText: 'text-orange-900',
                    winnerCol: 'winner-col-parks'
                }
            };

            /**
             * æ ¸å¿ƒå‡½æ•°ï¼šåˆå§‹åŒ–ä¸€ä¸ªè®¡åˆ†è¡¨
             * @param {object} config - åŒ…å«æ‰€æœ‰ ID å’Œä¸»é¢˜é…ç½®çš„å¯¹è±¡
             */
            function initializeScoreTable(config) {
                const table = document.getElementById(config.tableId);
                if (!table) return; // å¦‚æœæ‰¾ä¸åˆ°è¡¨æ ¼ï¼Œåˆ™é€€å‡º

                const theadRow = document.getElementById(config.playerNameRowId);
                
                // ä¿®å¤ï¼šåœ¨è¿™é‡Œå®šä¹‰æ‰€æœ‰å†…éƒ¨å˜é‡
                const theadRemoveRow = document.getElementById(config.removeRowId);
                const tbodyRows = table.querySelectorAll('tbody tr');
                const tfootTotalRow = document.getElementById(config.totalRowId);
                const addPlayerBtn = document.getElementById(config.addPlayerBtnId);
                const resetGameBtn = document.getElementById(config.resetGameBtnId);
                
                let playerCount = 0;
                const WINNER_CLASS = config.theme.winnerCol;

                // --- åŠ¨æ€åº”ç”¨ä¸»é¢˜ ---
                theadRow.classList.add(config.theme.playerRow);
                theadRow.querySelector('th').classList.add(config.theme.playerRowSticky);
                tfootTotalRow.classList.add(config.theme.totalRow);
                tfootTotalRow.querySelector('td').classList.add(config.theme.totalRowSticky);
                tfootTotalRow.querySelector('.total-text-placeholder').classList.add(config.theme.totalText);

                
                /**
                 * æ·»åŠ ä¸€ä¸ªæ–°ç©å®¶ (ä¸€æ•´åˆ—)
                 */
                function robustAddPlayer() {
                    playerCount++;
                    
                    // 1. æ·»åŠ è¡¨å¤´ (ç©å®¶åå­—)
                    const th = document.createElement('th');
                    th.className = 'p-2';
                    const playerNameInput = document.createElement('input');
                    playerNameInput.type = 'text';
                    playerNameInput.value = `${config.defaultPlayerPrefix} ${playerCount}`;
                    playerNameInput.className = 'player-name-input';
                    
                    playerNameInput.addEventListener('focus', function() {
                        this.setAttribute('data-placeholder', this.value);
                        this.value = '';
                    });
                    playerNameInput.addEventListener('blur', function() {
                        if (this.value.trim() === '') {
                            this.value = this.getAttribute('data-placeholder');
                        }
                        this.removeAttribute('data-placeholder');
                    });
                    th.appendChild(playerNameInput);
                    theadRow.appendChild(th);

                    // 2. ä¸ºæ¯ä¸ªè®¡åˆ†é¡¹æ·»åŠ è¾“å…¥æ¡† (tbody)
                    // (æ­¤ä»£ç ä¼šè‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰ tbody tr, åŒ…æ‹¬æˆ‘ä»¬æ–°åŠ çš„è¡Œ)
                    tbodyRows.forEach(row => {
                        const td = document.createElement('td');
                        td.className = 'p-2 text-center';
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.min = '0';
                        input.value = '0';
                        input.className = 'score-input table-input';
                        input.addEventListener('input', (e) => robustUpdateScore(e.target));
                        input.addEventListener('wheel', (e) => {
                            e.preventDefault();
                            let value = parseInt(input.value) || 0;
                            if (e.deltaY < 0) value++; else value--;
                            input.value = Math.max(0, value);
                            robustUpdateScore(e.target);
                        });
                        input.addEventListener('focus', function() {
                            if (this.value === '0') this.value = '';
                            else this.select();
                        });
                        input.addEventListener('blur', function() {
                            if (this.value.trim() === '') this.value = '0';
                            robustUpdateScore(this);
                        });
                        td.appendChild(input);
                        row.appendChild(td);
                    });

                    // 3. æ·»åŠ æ€»åˆ†å•å…ƒæ ¼ (tfoot)
                    const totalTd = document.createElement('td');
                    totalTd.className = 'p-3 text-center';
                    totalTd.innerHTML = `<span class="total-score text-4xl font-black ${config.theme.totalText}">0</span>`;
                    tfootTotalRow.appendChild(totalTd);

                    // 4. æ·»åŠ ç§»é™¤æŒ‰é’®å•å…ƒæ ¼ (thead)
                    const removeTh = document.createElement('th');
                    removeTh.className = 'p-3 text-center';
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-player text-red-500 hover:text-red-700 font-bold text-2xl transition-colors';
                    removeBtn.title = 'ç§»é™¤ç©å®¶';
                    removeBtn.innerHTML = '&times;';
                    removeBtn.addEventListener('click', (e) => robustRemovePlayer(e.target));
                    removeTh.appendChild(removeBtn);
                    theadRemoveRow.appendChild(removeTh);

                    highlightWinners();
                }

                /**
                 * ç§»é™¤ä¸€ä¸ªç©å®¶ (ä¸€æ•´åˆ—)
                 */
                function robustRemovePlayer(button) {
                    const colIndex = button.closest('th').cellIndex;
                    if (colIndex > 0) {
                        table.querySelectorAll('tr').forEach(row => {
                            if (row.children[colIndex]) {
                                row.removeChild(row.children[colIndex]);
                            }
                        });
                        highlightWinners();
                    }
                }
                
                /**
                 * æ›´æ–°ä¸€ä¸ªç©å®¶çš„æ€»åˆ†
                 */
                function robustUpdateScore(input) {
                    const colIndex = input.closest('td').cellIndex;
                    if (colIndex > 0) {
                        let total = 0;
                        tbodyRows.forEach(row => {
                            const cell = row.children[colIndex];
                            if (cell) {
                                const scoreInput = cell.querySelector('.score-input');
                                total += parseInt(scoreInput.value) || 0;
                            }
                        });

                        const totalCell = tfootTotalRow.children[colIndex];
                        if (totalCell) {
                            totalCell.querySelector('.total-score').textContent = total;
                        }
                        highlightWinners();
                    }
                }

                /**
                 * é«˜äº®æ˜¾ç¤ºå¾—åˆ†æœ€é«˜çš„ç©å®¶åˆ—
                 */
                function highlightWinners() {
                    const totalCells = tfootTotalRow.querySelectorAll('td');
                    let maxScore = -1;
                    const scores = [];

                    if (totalCells.length <= 1) return;

                    for (let i = 1; i < totalCells.length; i++) {
                        const total = parseInt(totalCells[i].textContent) || 0;
                        scores.push(total);
                        if (total > maxScore) maxScore = total;
                    }
                    
                    const effectiveMaxScore = maxScore > 0 ? maxScore : -1;

                    scores.forEach((score, index) => {
                        const colIndex = index + 1;
                        if (score === effectiveMaxScore) {
                            table.querySelectorAll('tr').forEach(row => {
                                if(row.children[colIndex]) row.children[colIndex].classList.add(WINNER_CLASS);
                            });
                        } else {
                            table.querySelectorAll('tr').forEach(row => {
                                if(row.children[colIndex]) row.children[colIndex].classList.remove(WINNER_CLASS);
                            });
                        }
                    });
                }

                /**
                 * é‡ç½®æ¸¸æˆåˆ†æ•° (ä¿ç•™ç©å®¶åå­—)
                 */
                function robustResetGame() {
                    const numPlayerCols = theadRow.children.length - 1;
                    
                    for (let colIndex = 1; colIndex <= numPlayerCols; colIndex++) {
                        tbodyRows.forEach(row => {
                            const cell = row.children[colIndex];
                            if (cell) {
                                const input = cell.querySelector('.score-input');
                                if (input) input.value = '0';
                            }
                        });
                        
                        const totalCell = tfootTotalRow.children[colIndex];
                        if (totalCell) {
                            totalCell.querySelector('.total-score').textContent = '0';
                        }
                    }
                    highlightWinners();
                }

                // --- åˆå§‹åŒ–æ­¤è¡¨æ ¼ ---
                addPlayerBtn.addEventListener('click', robustAddPlayer);
                resetGameBtn.addEventListener('click', robustResetGame);

                // æ¸¸æˆå¼€å§‹æ—¶é»˜è®¤æ·»åŠ  2 ä¸ªç©å®¶
                robustAddPlayer();
                robustAddPlayer();
            }

            // --- å¯åŠ¨ä¸¤ä¸ªè®¡åˆ†å™¨ ---
            initializeScoreTable(wsConfig);
            initializeScoreTable(parksConfig);
        });
    </script>

</body>
</html>
